var redis = require("redis");

var client = {};

function init() {
    console.log("Trying to connect to Redis");
    client = redis.createClient(6379, 'redis', {no_ready_check: true});

    client.on('error', function (err) {
        settimeout(init, 1000);
    }); 
    
    client.on('connect', function() {
        console.log('Connected to Redis');
    });
}

function get(key) {
    console.log("Getting Redis variable");
    const { promisify } = require("util");
    const getAsync = promisify(client.get).bind(client);
    return getAsync(key);
}

function set(key, val) {
    console.log("Setting Redis variable");
    const { promisify } = require("util");
    const setAsync = promisify(client.set).bind(client);
    return setAsync(key, val);
}



module.exports = {
    init: init,
    set: set,
    get: get
}